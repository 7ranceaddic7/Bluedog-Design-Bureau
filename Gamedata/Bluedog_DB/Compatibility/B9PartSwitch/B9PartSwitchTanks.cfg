//
// Thanks Nertea
//

@PART[bluedog*,Bluedog*]:HAS[@RESOURCE[LiquidFuel],@RESOURCE[Oxidizer],!RESOURCE[MonoPropellant],!MODULE[ModuleEngines*],!MODULE[WBIResourceSwitcher]]:NEEDS[B9PartSwitch]:FOR[Bluedog_DB_1]
{
	%tank_volume = #$RESOURCE[LiquidFuel]/maxAmount$
	@tank_volume += #$RESOURCE[Oxidizer]/maxAmount$
	
	%fuel_cost = #$RESOURCE[LiquidFuel]/amount$
	@fuel_cost *= #$@RESOURCE_DEFINITION[LiquidFuel]/unitCost$
	%ox_cost = #$RESOURCE[Oxidizer]/amount$
	@ox_cost *= #$@RESOURCE_DEFINITION[Oxidizer]/unitCost$
	@fuel_cost += #$ox_cost$
	
	%tank_mass = #$tank_volume$
	@tank_mass *= #$@B9_TANK_TYPE[bdbLFOX]/tankMass$
	
	extraMass = #$mass$
	@extraMass -= #$tank_mass$
	
	tank_cost = #$tank_volume$
	@tank_cost *= #$@B9_TANK_TYPE[bdbLFOX]/tankCost$
	
	extraCost = #$cost$
	@extraCost -= #$tank_cost$
	@extraCost -= #$fuel_cost$
	
	@cost = #$tank_cost$
	@cost += #$fuel_cost$
	
	!RESOURCE[LiquidFuel] {}
	!RESOURCE[Oxidizer] {}
	
	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = fuelSwitch
		switcherDescription = Fuel
		baseVolume = #$../tank_volume$
		SUBTYPE
		{
			name = LF/O
			tankType = bdbLFOX
			addedMass = #$../../tank_mass$
			@addedMass *= -1
			addedCost = #$../../cost$
			@addedCost *= -1
		}
		SUBTYPE
		{
			name = LH2/O
			tankType = bdbLH2O
			addedMass = #$../../tank_mass$
			@addedMass *= -1
			addedCost = #$../../cost$
			@addedCost *= -1
		}
		SUBTYPE
		{
			name = MonoProp
			tankType = bdbMonoProp
			addedMass = #$../../tank_mass$
			@addedMass *= -1
			addedCost = #$../../cost$
			@addedCost *= -1
		}
	}
}

@PART[bluedog*,Bluedog*]:HAS[@RESOURCE[LqdHydrogen],@RESOURCE[Oxidizer],!RESOURCE[MonoPropellant],!MODULE[ModuleEngines*],!MODULE[WBIResourceSwitcher]]:NEEDS[B9PartSwitch]:FOR[Bluedog_DB_1]
{
	%tank_volume = #$RESOURCE[LqdHydrogen]/maxAmount$
	@tank_volume /= 5
	@tank_volume += #$RESOURCE[Oxidizer]/maxAmount$
	
	%fuel_cost = #$RESOURCE[LqdHydrogen]/amount$
	@fuel_cost *= #$@RESOURCE_DEFINITION[LqdHydrogen]/unitCost$
	%ox_cost = #$RESOURCE[Oxidizer]/amount$
	@ox_cost *= #$@RESOURCE_DEFINITION[Oxidizer]/unitCost$
	@fuel_cost += #$ox_cost$
	
	%tank_mass = #$tank_volume$
	@tank_mass *= #$@B9_TANK_TYPE[bdbLH2O]/tankMass$
	
	extraMass = #$mass$
	@extraMass -= #$tank_mass$
	
	tank_cost = #$tank_volume$
	@tank_cost *= #$@B9_TANK_TYPE[bdbLH2O]/tankCost$
	
	extraCost = #$cost$
	@extraCost -= #$tank_cost$
	@extraCost -= #$fuel_cost$
	
	@cost = #$tank_cost$
	@cost += #$fuel_cost$
	
	!RESOURCE[LqdHydrogen] {}
	!RESOURCE[Oxidizer] {}
	
	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = fuelSwitch
		switcherDescription = Fuel
		baseVolume = #$../tank_volume$
		SUBTYPE
		{
			name = LH2/O
			tankType = bdbLH2O
			addedMass = #$../../tank_mass$
			@addedMass *= -1
			addedCost = #$../../cost$
			@addedCost *= -1
		}
		SUBTYPE
		{
			name = LF/O
			tankType = bdbLFOX
			addedMass = #$../../tank_mass$
			@addedMass *= -1
			addedCost = #$../../cost$
			@addedCost *= -1
		}
		SUBTYPE
		{
			name = MonoProp
			tankType = bdbMonoProp
			addedMass = #$../../tank_mass$
			@addedMass *= -1
			addedCost = #$../../cost$
			@addedCost *= -1
		}
	}
}

@PART[bluedog*,Bluedog*]:HAS[@RESOURCE[LqdHydrogen],!MODULE[ModuleBdbBoiloff]]:FOR[Bluedog_DB_8]
{
	MODULE
	{
		name = ModuleBdbBoiloff
		CRYOGENICRESOURCE
		{
			name = LqdHydrogen
			boiloffRate = 8
		}
	}
}

@PART[bluedog*,Bluedog*]:HAS[@MODULE[ModuleB9PartSwitch],!MODULE[ModuleBdbBoiloff]]:FOR[Bluedog_DB_8]
{
	MODULE
	{
		name = ModuleBdbBoiloff
		CRYOGENICRESOURCE
		{
			name = LqdHydrogen
			boiloffRate = 8
		}
	}
}

@PART[bluedog*,Bluedog*]:HAS[@MODULE[WBIResourceSwitcher],!MODULE[ModuleBdbBoiloff]]:FOR[Bluedog_DB_8]
{
	MODULE
	{
		name = ModuleBdbBoiloff
		CRYOGENICRESOURCE
		{
			name = LqdHydrogen
			boiloffRate = 8
		}
	}
}

@PART[bluedog*,Bluedog*]:FOR[zzzBluedog_DB_9]
{
	!tank_volume = delete
	!fuel_cost = delete
	!ox_cost = delete
	!tank_mass = delete
	!extraCost = delete
	!extraMass = delete
}

@PART[bluedog*,Bluedog*]:AFTER[zzz_CryoTanks]
{
	!MODULE[ModuleB9PartSwitch]:HAS[#switcherDescription[Tank?Type]] {} // CryoTanks uses "Tank Type", we use "Fuel"
	!MODULE[ModuleCryoTank] {}
}
